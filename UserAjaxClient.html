<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript">
function query(){
	var url = "http://square.ys7.com/square/demoCameraApplyAction!queryShareCamera.action?cameraId=" + document.getElementById("camId").value;
	document.getElementById("p1").innerHTML = "开始查询";
	//创建XMLHttpRequest对象
	var xhr = new XMLHttpRequest();
	//打开连接
	xhr.open("GET",url,true);
	//设置回调函数
	xhr.onreadystatechange=function(){
		//判断是否发送成功和判断服务器响应是否正确
		if(4 == xhr.readyState && 200 == xhr.status){
			var res = xhr.responseText;
			//document.getElementById("p3").innerHTML = "响应文本:" + xhr.responseText;
			var len = res.length;
			var jsonStr = res.substring(res.indexOf("(")+1,len-1);

			//document.getElementById("p3").innerHTML = jsonStr;
                                 var jsonObj = eval("("+jsonStr+")");
                                 var cameras = jsonObj.demoCameras;
			var camCount = cameras.length;
                                 alert(camCount);

/* 摄像机参数
			var subSerail = eval("("+jsonStr+")").demoCameras[0].subSerail;
			var cityCode = eval("("+jsonStr+")").demoCameras[0].cityCode;
			var vtduPort = eval("("+jsonStr+")").demoCameras[0].vtduPort;
			var city = eval("("+jsonStr+")").demoCameras[0].city;
			var indexCode = eval("("+jsonStr+")").demoCameras[0].indexCode;
			var description = eval("("+jsonStr+")").demoCameras[0].description;
			var hlsAddr = eval("("+jsonStr+")").demoCameras[0].hlsAddr;
			var ggLongitude = eval("("+jsonStr+")").demoCameras[0].ggLongitude;
			var ggLatitude = eval("("+jsonStr+")").demoCameras[0].ggLatitude;
			var webSocketUrl = eval("("+jsonStr+")").demoCameras[0].webSocketUrl;
			var streamType = eval("("+jsonStr+")").demoCameras[0].streamType;
			var cdnUrl = eval("("+jsonStr+")").demoCameras[0].cdnUrl;
			var likeCount = eval("("+jsonStr+")").demoCameras[0].likeCount;		//喜欢的人数
			var cameraName = eval("("+jsonStr+")").demoCameras[0].cameraName;
			var deviceStatus = eval("("+jsonStr+")").demoCameras[0].deviceStatus;
			var favoriteCount = eval("("+jsonStr+")").demoCameras[0].favoriteCount;
			var address = eval("("+jsonStr+")").demoCameras[0].address;
			var viewedCount = eval("("+jsonStr+")").demoCameras[0].viewedCount;
			var hlsPort = eval("("+jsonStr+")").demoCameras[0].hlsPort;
			var rtmpAddr = eval("("+jsonStr+")").demoCameras[0].rtmpAddr;
			var rtmpPort = eval("("+jsonStr+")").demoCameras[0].rtmpPort;
			var channel = eval("("+jsonStr+")").demoCameras[0].channel;
			var deviceSerial = eval("("+jsonStr+")").demoCameras[0].deviceSerial;
			var name = eval("("+jsonStr+")").demoCameras[0].name;
			var subChannel = eval("("+jsonStr+")").demoCameras[0].subChannel;
			var channelNo = eval("("+jsonStr+")").demoCameras[0].channelNo;
			var id = eval("("+jsonStr+")").demoCameras[0].id;
			var devType = eval("("+jsonStr+")").demoCameras[0].devType;
			var vodCoverUrl = eval("("+jsonStr+")").demoCameras[0].vodCoverUrl;
			var nickname = eval("("+jsonStr+")").demoCameras[0].nickname;
			var status = eval("("+jsonStr+")").demoCameras[0].status;
			var isOpenSound = eval("("+jsonStr+")").demoCameras[0].isOpenSound;

*/

			var table1 = document.createElement("table");

			var list = document.createElement("div");
			var p1 = document.createElement("p");
			var p1_text = document.createTextNode("[playlist]");
			p1.appendChild(p1_text);
			list.appendChild(p1);
			var p2 = document.createElement("p");
			var p2_text = document.createTextNode("NumberOfEntries="+camCount);
			p2.appendChild(p2_text);
			list.appendChild(p2);

			
			for(i=0;i<camCount;i++){

				var subSerail = eval("("+jsonStr+")").demoCameras[i].subSerail;
				var cityCode = eval("("+jsonStr+")").demoCameras[i].cityCode;
				var vtduPort = eval("("+jsonStr+")").demoCameras[i].vtduPort;
				var city = eval("("+jsonStr+")").demoCameras[i].city;
				var indexCode = eval("("+jsonStr+")").demoCameras[i].indexCode;
				var description = eval("("+jsonStr+")").demoCameras[i].description;
				var hlsAddr = eval("("+jsonStr+")").demoCameras[i].hlsAddr;
				var ggLongitude = eval("("+jsonStr+")").demoCameras[i].ggLongitude;
				var ggLatitude = eval("("+jsonStr+")").demoCameras[i].ggLatitude;
				var webSocketUrl = eval("("+jsonStr+")").demoCameras[i].webSocketUrl;
				var streamType = eval("("+jsonStr+")").demoCameras[i].streamType;
				var cdnUrl = eval("("+jsonStr+")").demoCameras[i].cdnUrl;
				var likeCount = eval("("+jsonStr+")").demoCameras[i].likeCount;		//喜欢的人数
				var cameraName = eval("("+jsonStr+")").demoCameras[i].cameraName;
				var deviceStatus = eval("("+jsonStr+")").demoCameras[i].deviceStatus;
				var favoriteCount = eval("("+jsonStr+")").demoCameras[i].favoriteCount;
				var address = eval("("+jsonStr+")").demoCameras[i].address;
				var viewedCount = eval("("+jsonStr+")").demoCameras[i].viewedCount;
				var hlsPort = eval("("+jsonStr+")").demoCameras[i].hlsPort;
				var rtmpAddr = eval("("+jsonStr+")").demoCameras[i].rtmpAddr;
				var rtmpPort = eval("("+jsonStr+")").demoCameras[i].rtmpPort;
				var channel = eval("("+jsonStr+")").demoCameras[i].channel;
				var deviceSerial = eval("("+jsonStr+")").demoCameras[i].deviceSerial;
				var name = eval("("+jsonStr+")").demoCameras[i].name;
				var subChannel = eval("("+jsonStr+")").demoCameras[i].subChannel;
				var channelNo = eval("("+jsonStr+")").demoCameras[i].channelNo;
				var id = eval("("+jsonStr+")").demoCameras[i].id;
				var devType = eval("("+jsonStr+")").demoCameras[i].devType;
				var vodCoverUrl = eval("("+jsonStr+")").demoCameras[i].vodCoverUrl;
				var nickname = eval("("+jsonStr+")").demoCameras[i].nickname;
				var status = eval("("+jsonStr+")").demoCameras[i].status;
				var isOpenSound = eval("("+jsonStr+")").demoCameras[i].isOpenSound;
				
				var streamUrl = "rtmp://"+rtmpAddr+":1935/livestream/"+subSerail+"_"+channelNo+"_1_1_0"

				//var params0 = new Array(subSerail,cameraName,rtmpAddr,subChannel,channelNo,streamUrl,ggLongitude,ggLatitude);
				var params = new Array(subSerail,cameraName,streamUrl,ggLongitude,ggLatitude,vodCoverUrl);

				var tr = document.createElement("tr");

				for(j=0;j<params.length;j++){
					if(j==5){
						var td = document.createElement("td");
						var img = document.createElement("img");
						img.src = params[j];
						img.width = "200";
						td.appendChild(img);
						tr.appendChild(td);
					}else{
					var td = document.createElement("td");
					var text = document.createTextNode(params[j]);
					td.appendChild(text);
					tr.appendChild(td);
					}
				}
				table1.appendChild(tr);

				//组装播放列表
				var pUrl = document.createElement("div");
				var pTitlel = document.createElement("div");
				var urlText = document.createTextNode("File"+(i+1)+"="+streamUrl);
				var TitleText = document.createTextNode("Title"+(i+1)+"="+cameraName);
				pUrl.appendChild(urlText);
				pTitlel.appendChild(TitleText);
				list.appendChild(pUrl);
				list.appendChild(pTitlel);
			}
			
			document.getElementById("table").appendChild(table1);
			document.getElementById("table").appendChild(list);
			

/*
[playlist]
NumberOfEntries=29
File1=rtmp://124.232.148.23:1935/live/sc_jzg_0001
Title1=sc_jzg_0001-四川九寨沟五花海
*/
		}
	}
	
	xhr.send(null);


	
}

</script>

<style type="text/css">
#cam  {
border:1px solid #000;
position:absolute;
left:10px;
top:10px;
width:220px;
}
</style>

</head>
<body>

<div id="cam">
<input type="text" id="camId" value="2014040"><input type="button" value="查询" onClick="javascript:query();">
</div>
<p id="p1"></p>
<p id="p2"></p>
<p id="p3"></p>
<div id="table"></div>
<div id="playList"></div>
</body>
</html>